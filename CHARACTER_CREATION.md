# Система создания персонажей D&D 5e

## Обзор

Система создания персонажей полностью соответствует правилам D&D 5e Basic Rules и поддерживает пошаговое создание персонажа в правильном порядке.

## Порядок создания персонажа согласно D&D 5e

### 1. Выбор расы
Раса определяет:
- Бонусы к характеристикам
- Скорость передвижения
- Особые способности
- Размер персонажа
- Языки

### 2. Выбор класса
Класс определяет:
- Кость хитов (d6, d8, d10, d12)
- Основную характеристику для заклинаний
- Владения оружием и доспехами
- Особые способности класса
- Навыки на выбор

### 3. Определение характеристик
**Метод 4d6:**
- Бросить 4d6 для каждой характеристики
- Отбросить минимальный результат
- Сложить оставшиеся 3 значения
- Повторить для всех 6 характеристик

**Ручной ввод:**
- Ввести значения от 3 до 18
- Распределить по характеристикам

### 4. Выбор предыстории
Предыстория предоставляет:
- Дополнительные навыки
- Снаряжение
- Дополнительные языки
- Особенности личности

### 5. Выбор навыков
- Навыки от класса (обычно 2-4 на выбор)
- Навыки от предыстории (автоматически)
- Исключить дублирующиеся навыки

### 6. Определение снаряжения
- Снаряжение класса
- Снаряжение предыстории
- Дополнительные предметы

### 7. Личность и внешность
- Имя персонажа
- Мировоззрение
- Внешность (возраст, рост, вес, цвет глаз/кожи/волос)
- История персонажа

## Генерация характеристик

### Случайная генерация (4d6, отбросить минимальный)

**Эндпоинт:** `POST /api/games/character-creation/roll-abilities`

**Запрос:**
```json
{
  "method": "random"
}
```

**Ответ:**
```json
{
  "scores": [16, 14, 13, 12, 10, 8],
  "method": "random"
}
```

### Ручная настройка характеристик

**Эндпоинт:** `POST /api/games/character-creation/roll-abilities`

**Запрос:**
```json
{
  "method": "manual",
  "scores": [16, 14, 12, 10, 8, 6]
}
```

**Ответ:**
```json
{
  "scores": [16, 14, 12, 10, 8, 6],
  "method": "manual"
}
```

### Валидация ручных характеристик

**Эндпоинт:** `POST /api/games/character-creation/validate-abilities`

**Запрос:**
```json
{
  "scores": [18, 16, 14, 12, 10, 8]
}
```

**Ответ:**
```json
{
  "valid": true,
  "scores": [18, 16, 14, 12, 10, 8],
  "modifiers": [4, 3, 2, 1, 0, -1],
  "totalModifier": 9
}
```

## Правила валидации

- Все характеристики должны быть числами от 3 до 18
- Должно быть ровно 6 характеристик
- Характеристики автоматически сортируются по убыванию

## Создание персонажа

### Эндпоинт
`POST /api/games/user/{userId}/dnd-character`

### Пример запроса
```json
{
  "name": "Тестовый Герой",
  "race": "human",
  "characterClass": "fighter",
  "background": "soldier",
  "abilityScores": [16, 14, 12, 10, 8, 6],
  "skillChoices": ["athletics", "intimidation"],
  "alignment": "Lawful Good",
  "appearance": {
    "age": 25,
    "height": "180 см",
    "weight": "80 кг",
    "eyes": "Карие",
    "skin": "Светлая",
    "hair": "Темно-русые"
  },
  "personality": {
    "traits": ["Храбрый", "Честный"],
    "ideals": ["Защита слабых"],
    "bonds": ["Верность команде"],
    "flaws": ["Слишком доверчивый"]
  },
  "backstory": "Тестовый персонаж для проверки системы создания."
}
```

## Доступные расы (D&D 5e Basic Rules)

- `human` - Человек (+1 ко всем характеристикам)
- `elf` - Эльф (+2 к Ловкости)
- `dwarf` - Дварф (+2 к Телосложению)
- `halfling` - Полурослик (+2 к Ловкости)
- `dragonborn` - Драконорожденный (+2 к Силе, +1 к Харизме)
- `gnome` - Гном (+2 к Интеллекту)
- `half-elf` - Полуэльф (+2 к Харизме, +1 к Силе и Ловкости)
- `half-orc` - Полуорк (+2 к Силе, +1 к Телосложению)
- `tiefling` - Тифлинг (+1 к Интеллекту, +2 к Харизме)

## Доступные классы (D&D 5e Basic Rules)

- `fighter` - Воин (d10, владения всеми оружием и доспехами)
- `wizard` - Волшебник (d6, заклинания на основе Интеллекта)
- `rogue` - Разбойник (d8, скрытность и точные удары)
- `cleric` - Жрец (d8, божественная магия)
- `ranger` - Следопыт (d10, охота и выживание)
- `paladin` - Паладин (d10, святая магия и бой)
- `barbarian` - Варвар (d12, боевая ярость)
- `bard` - Бард (d8, вдохновляющая магия)
- `druid` - Друид (d8, природная магия)
- `monk` - Монах (d8, боевые искусства)
- `sorcerer` - Чародей (d6, врожденная магия)
- `warlock` - Колдун (d8, пактовая магия)

## Доступные предыстории (D&D 5e Basic Rules)

- `acolyte` - Послушник (религиозные навыки)
- `criminal` - Преступник (скрытность и обман)
- `folk-hero` - Народный герой (выживание и уход за животными)
- `noble` - Благородный (история и убеждение)
- `sage` - Мудрец (магия и история)
- `soldier` - Солдат (атлетика и запугивание)
- `urchin` - Бродяга (ловкость рук и скрытность)

## Особенности системы

### Правильный порядок создания
1. **Раса** - определяет базовые характеристики
2. **Класс** - определяет способности и владения
3. **Характеристики** - 4d6 или ручной ввод
4. **Предыстория** - дополнительные навыки и снаряжение
5. **Навыки** - выбор из доступных навыков класса
6. **Снаряжение** - автоматическое назначение
7. **Личность** - имя, мировоззрение, внешность
8. **Завершение** - проверка и создание персонажа

### Автоматические вычисления
- Применение бонусов расы к характеристикам
- Вычисление модификаторов характеристик
- Определение HP (максимум кости хитов + модификатор конституции)
- Определение класса брони
- Назначение снаряжения от класса и предыстории

### Валидация
- Проверка характеристик (3-18)
- Проверка выбора расы и класса
- Проверка количества выбранных навыков
- Проверка обязательных полей

## Тестирование

Запустите тестовый файл для проверки функциональности:

```bash
cd backend
node test-character-creation.js
```

Тест проверит:
- Случайную генерацию характеристик
- Ручную настройку характеристик
- Валидацию характеристик
- Создание персонажей с разными методами генерации
- Обработку ошибок валидации
- Правильный порядок создания персонажа 